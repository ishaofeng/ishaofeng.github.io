<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="http://www.smalllv.cn" >
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="keywords" content="Linux,Python,Vim,Hadoop,Redis,大数据,跑步" />
    <meta name="description" content="小毛驴CodingWorld, 记录一个Coder的成长" />
    <meta name="baidu-site-verification" content="OqbZT1T9J5" />
    <title>
HTTP学习记录--小毛驴
</title>
    <link rel="shortcut icon" href="/donkey.ico" />
    <link rel="bookmark" href="/donkey.ico"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Loading Bootstrap -->
    <link href="css/vendor/bootstrap.min.css" rel="stylesheet">
    <!-- Loading Flat UI -->
    <link href="css/flat-ui.css" rel="stylesheet">
      
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/highlight/github.css" rel="stylesheet">

    <link href="css/style.css" rel="stylesheet">
     
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://www.smalllv.cn/rss.xml">


    <!-- HTML5 shim, for IE6-8 support of HTML5 elements. All other JS at the end of file. -->
    <!--[if lt IE 9]>
      <script src="js/vendor/html5shiv.js"></script>
      <script src="js/vendor/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        .container {
            margin-top: 53px;
        }
        
        #login {
            margin-left: 40px;
        }
        
        
        
    </style>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse-5">
            <span class="sr-only">Toggle navigation</span>
          </button>
          <a class="navbar-brand" href="#">小毛驴</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-5">
          <ul class="nav navbar-nav">
            <li><a href="#">主页</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">分类<b class="caret"></b></a>
              <ul class="dropdown-menu">
                
                    <li><a href="/tags/生活杂记.html">生活杂记</a></li>
                
                    <li><a href="/tags/python.html">python</a></li>
                
                    <li><a href="/tags/源码阅读.html">源码阅读</a></li>
                
                    <li><a href="/tags/网络知识.html">网络知识</a></li>
                
                    <li><a href="/tags/redis.html">redis</a></li>
                
                    <li><a href="/tags/工具.html">工具</a></li>
                
                    <li><a href="/tags/ 工具.html"> 工具</a></li>
                
              </ul>
            </li>
            <li><a href="/about.html">关于我</a></li>
           </ul>
          <form class="navbar-form navbar-right" action="javascript:search()" role="search">
            <div class="form-group">
              <div class="input-group">
                <input class="form-control" id="searchinput" type="search" placeholder="Search">
                <span class="input-group-btn">
                  <button type="submit" class="btn"><span class="icon-search"></span></button>
                </span>
              </div>
            </div>
            <div class="form-group">
                <button class="btn btn-primary" id="login">
                    <i class="icon-github icon-large"></i>
                    登陆
                </button>
            </div>
          </form>
        </div><!-- /.navbar-collapse -->
      </nav>

    <div class="container">
             

<h2>HTTP学习记录</h2>
<hr />
<h2>一.HTTP协议</h2>
<ol>
<li>HTTP使用可靠的数据传输协议,不用担心数据在传输过程中被破坏,复制或产生畸变.</li>
<li>Web服务器是Web资源的宿主</li>
<li>MIME: HTTP为每种通过Web传输的对象打上名为MIME的数据格式标签.
   MIME是一种文本标记, 表示一种主要的对象类型和一个特定的子类型
    例如: html格式文件 text/html   JPEG格式图片 image/jpeg</li>
<li>URI(Uniform Resource Identifier, URI)统一资源标识符 用来表示服务器资源的名称
分为URL和URN
URL: 统一资源定位符  分为三个部分1) scheme 2) 服务器地址 3) 指定的资源
     http://www.smalllv.cn/js/bootstrap.js
     http://  是scheme
     www.smalllv.cn  是服务器地址
     /js/bootstrap.js  指定的资源
URN: 统一资源名 特定内容的唯一名称使用,与资源所处的位置无关</li>
</ol>
<h3>1.5. 事务</h3>
<p>一个HTTP事务是由一个HTTP请求命令和一个响应结果组成,通讯是通过格式化的HTTP报文完成</p>
<h4>1.5.1 方法: 每条HTTP请求报文都包含一个方法, 告诉服务器执行什么动作</h4>
<p>GET      从服务器向客户端发送命名资源
PUT      将来自客户端的数据存储到一个命名的服务器资源中区
DELETE   从服务器中删除命名资源
POST     将客户端数据发送到一个服务器网管应用程序
HEAD     仅发送命名资源响应中的HTTP首部</p>
<blockquote>
<ol>
<li>在不获取资源的情况下了解资源的情况</li>
<li>通过查看响应中的状态码, 看看某个对象是否存在</li>
<li>通过查看首部,测试资源是否被修改了 </li>
</ol>
</blockquote>
<p><strong>安全方法:</strong>不产生动作的方法, HTTP请求不会在服务器内部产生什么结果 比如HEAD, GET方法</p>
<h4>1.5.2 状态码: 每一个HTTP响应报文都包含一个状态码, 告知用户请求是否成功.</h4>
<p>100~199: 信息提示
200~299: 成功</p>
<blockquote>
<ul>
<li>200 成功</li>
<li>201 已经创建</li>
<li>202 已经接受请求</li>
<li>204 无内容</li>
<li>205 重置当前页面内容</li>
</ul>
</blockquote>
<p>300~399: 重定向</p>
<blockquote>
<ul>
<li>300 多个选择</li>
<li>301 该请求的URL已经被移除使用</li>
<li>302 与301类似, 使用Location首部给出的URL作为临时URL</li>
<li>303 告诉客户端使用另外一个URL来获取资源</li>
<li>304 Not Modified</li>
<li>305 必须通过代理访问资源, 代理位置必须使用Location指定</li>
<li>307 与301类似, 临时重定向</li>
</ul>
</blockquote>
<p>400~499: 客户端错误</p>
<blockquote>
<ul>
<li>400 错误请求</li>
<li>401 未授权</li>
<li>403 禁止访问,不说明禁止的原因</li>
<li>404 没法找到请求的URL</li>
<li>405 请求的方法不允许, 响应的Allow首部说明允许的方法</li>
<li>406 不被接受</li>
<li>407 代理需要认证</li>
<li>408 请求超时</li>
<li>409 请求在资源引发冲突</li>
<li>411 服务器要求报文包含Content-Length</li>
<li>413 请求的实体太大</li>
</ul>
</blockquote>
<p>500~599: 服务端错误</p>
<blockquote>
<ul>
<li>500 服务器遇到一个妨碍它为请求提供服务的错误时</li>
<li>501 </li>
<li>502 Bad Gateway</li>
<li>503 服务当前不可用</li>
<li>504 网关超时</li>
<li>505 HTTP当前版本不支持</li>
</ul>
</blockquote>
<h3>1.6 报文</h3>
<p>报文是在HTTP之间发送的数据块
组成: 1) 起始行 对报文进行描述
     2) 首部块 包含属性
         * 通用首部: 既可以出现在请求报文又可以出现在响应报文
         * 请求首部: 提供更多关于请求的信息
         * 响应首部: 提供更多关于响应的信息
         * 实体首部: 描述主体的长度和响应, 或者资源自身
         * 扩展首部: 规范中没有定义的新首部</p>
<pre><code>     **首部延续行:**将长的首部分为多行可以提高可读性, 多出来的每行前面至少要有一个空格或者制表符.
 3) 主体 可选 数据
</code></pre>
<p><strong>请求报文:</strong>
```
    <method> <request-URL> <version>
    <headers></p>
<pre><code>&lt;entity-body&gt;
</code></pre>
<p><code>**响应报文:**</code>
    </version> <status> <reason-phrase>
    <headers></p>
<pre><code>&lt;entity-body&gt;
</code></pre>
<p>```
一个HTTP首部总是应该以一个空行结束</p>
<h3>1.7 连接</h3>
<p>HTTP是应用层协议, 网络通讯细节使用TCP实现
   TCP提供了:
   * 无插座的数据传输
   * 按序传输
   * 未分段的数据流</p>
<h3>1.8 Web的结构组件</h3>
<ul>
<li>代理: 位于客户端和服务器之间的HTTP中间实体</li>
<li>缓存: HTTP的仓库, 使常用页面的副本可以保存在离客户端更近的地方</li>
<li>网关: 连接其它应用程序的特殊Web服务器</li>
<li>隧道: 对HTTP通信报文进行盲转发的特殊代理</li>
<li>Agent代理: 发起自动HTTP请求的半智能Web服务器</li>
</ul>
<h2>二. HTTP连接</h2>
<h3>3.1概述</h3>
<p>HTTP连接是通过TCP/IP建立的， TCP为HTTP提供了一条可靠的比特传输通道，从TCP连接一端填入的字节会从
另一端<strong>以原有的顺序</strong>，<strong>正确的</strong>传输出来。</p>
<blockquote>
<p>向http://www.smalllv.cn/index.html发送GET请求，整个连接过程如下
1. 浏览器解析出主机名  www.smalllv.cn
2. 浏览器通过DNS查询当前主机名对应的ip地址
3. 浏览器获取端口号
4. 浏览器发起到解析出来ip地址和端口的tcp连接 
5. 浏览器向服务器发送一条HTTP GET报文
6. 浏览器从服务器读取HTTP响应报文
7. 浏览器关闭连接</p>
</blockquote>
<pre><code>HTTP是协议栈是 HTTP&lt;--TCP&lt;--IP  HTTPS是在HTTP与TCP之间添加了一个TSL或SSL安全层
</code></pre>
<h3>3.2TCP连接</h3>
<p>一个HTTP请求过程中建立TCP连接时间以及请求和响应时间占大多数，实际的请求处理时间很短.
<em>TCP连接的握手时延:</em>
   TCP连接的建立过程:</p>
<blockquote>
<ol>
<li>请求新的TCP连接时，客户端向服务端发送一个小的TCP分组， 这个分组设置了特殊的SYN标记, 说明这是一个连接请求</li>
<li>如果服务器接受了连接， 就会对一些连接参数进行计算，并向客户端回送一个TCP分组，这个分组中的SYN和ACK标记都被置位，
    说明请求已经被接受</li>
<li>最后客户端向服务器回送一条确认信息， 通知它连接已经建立成功 （确认分组中允许发送数据)</li>
</ol>
</blockquote>
<p>用户是同TCP接口建立连接过程，中实际执行以上过程，我们感受到的是时延，小的HTTP事务可能会在TCP建立上花费50%的时间.</p>
<p><em>延迟确认:</em>
<strong>每一个TCP段都有一个序列号和数据完整性校验和</strong>, 每个数据段的接收者收到完好的段时，都会向发送者回送确认分组.
如果发送者没有在指定的窗口时间内收到确认信息，发送者就认为分组已经被破坏或者损坏，并重发数据. TCP延时确认算法会在一个
特定的窗口时间内将输出确认再放在缓冲区中，以寻求能够捎带它的输出数据分组，如果那个时间之内没有输出数据分组，确认信息将
直接进行发送,HTTP请求特点(双峰特征请求), 降低了捎带信息的可能， 往往增大时延.
<em>TCP慢启动:</em>
TCP连接会随着时间进行自我调谐，起初会限制连接的最大速度，如果数据成功传输，会随时间的推移提高传输的速度，这种调谐称为<strong>TCP慢启动</strong>,
用于防止因特网的突然过载和拥塞. (每成功接受一个分组，发送端就能发送更多分组), 新连接的速度会比已经交换过一定量数据的已调谐连接慢一些.
<em>Nagle算法与TCP_NODELAY:</em>
每个TCP段中至少装在了40个自己的标记和首部, 如果TCP发送大量包含少量数据的分组，网络的性能就会严重下降.Nagle算法试图在发送一个分组之前，
将大量TCP数据绑定在一起， 以提高网络效率。Nagle算法鼓励发送全尺寸数据，只有所有数据被确认后才允许发送非全尺寸。如果其它分组还在传输
过程中，就将那部分数据缓存起来，只有当挂起分组被确认，或者缓存中积累足够发送一个全尺寸数据时，才将缓存的数据发送出去。</p>
<p>HTTP中小报文无法填满分组因而不得不产生时延， Nagle算法组织数据发送，等待确认但是确认本身就有时延，因而产生更大的时延。</p>
<p>HTTP应用通常设置TCP_NODELAY禁止Nagle算法.</p>
<p><em>TIME_WAIT累积与端口耗尽:</em>
<strong>TCP连接断开过程:</strong></p>
<blockquote>
<ol>
<li>发起断开一方向另一方发送FIN消息</li>
<li>接收方发送确认ACK给发起者</li>
<li>一段时间后接收者发送FIN给发起者</li>
<li>发送者给接收者发送ACK,接收者关闭连接释放资源， 发送者进入TIME_WAIT状态，并在2ML周期内保留该状态， 之后关闭连接.</li>
</ol>
</blockquote>
<p>TIME_WAIT周期是为了响应由于第四步ack失败，接收端重新发送的FIN， 为连接中离群的段提供网络消失的时间.</p>
<h3>3.3 HTTP连接的处理</h3>
<ul>
<li>并行连接: 同时发起多个事务</li>
<li>持久连接: 在事务处理结束之后仍然保持在打开状态的TCP连接. (能够避免连接建立时间和慢启动适应时间)</li>
<li>并行和持久同时使用</li>
</ul>
<p>持久连接： 
1) HTTP/1.0  "keep-alive"连接 </p>
<blockquote>
<p>Connection: Keep-Alive 在HTTP首部设置，打开持久连接, 将一条连接保持在持久状态.
Keep-Alive首部用来调节keep-alive行为</p>
<blockquote>
<p>Connection: Keep-Alive
Keep-Alive: max-5, timeout=120
表示服务器最多还会为另外5个事务保持连接打开状态，或者将打开状态保持到连接空闲了2分钟之后.
服务器支持keep-alive则回送一个<code>Connection: Keep-Alive</code>否则不回送.</p>
</blockquote>
</blockquote>
<p>2) HTTP/1.1 "persistent" 连接</p>
<blockquote>
<p>连接默认激活， 需要关闭在头部添加 Connection: close
3) 管道化连接</p>
</blockquote>
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"smalllv"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->


    </div>
      
    <script type="text/javascript">
        function hasClass(obj, cls) {  
            return obj.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));  
        }
        function addClass(obj, cls) {  
            if (!this.hasClass(obj, cls)) obj.className += " " + cls;  
        } 

       function render_pretty(){
            var pres = $("pre");
            for (var i = 0; i < pres.length; ++i) 
            {
                if (pres[i].firstChild && pres[i].firstChild.nodeName == "CODE")
                {
                    hljs.highlightBlock(pres[i].firstChild);
                }
            }
        }

        window.onload = function(){
           render_pretty();
        };

        var search = function() {
            q = document.getElementById("searchinput");
            if (q.value != "") {
                window.open('http://www.baidu.com/s?si=www.smalllv.cn&cl=3&ct=2097152&tn=bds&word=' + q.value, "_blank");
                return false;
            } else {
                return false;
            }
        };

    </script>
   <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1253231687'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/z_stat.php%3Fid%3D1253231687%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>

    <!-- jQuery (necessary for Flat UI's JavaScript plugins) -->
    <script src="js/vendor/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/flat-ui.min.js"></script>
    <script src="js/highlight.pack.js"></script>

  </body>
</html>